#: import threading threading
WindowManager:
    MainScreen:
        id: main
    InventarioScreen:
        id: inventario
    ShapefileScreen:
        id: shapefilescreen
    # LoadingScreen:
    #     id: loading

<MainScreen>:
    name: 'main'
    FloatLayout:
        MapView:
            id: map
            lat: -10
            lon: -50
            zoom: 5
            size_hint: 1, 0.99
        ProgressBar:
            id: progressbar
            size_hint: 1, 0.01
            pos_hint: {'x':0, 'y':0.99}
            max: 100

        Button:
            text: 'Selecionar Inventario'
            size_hint: 0.2, 0.05
            pos_hint: {'x':0, 'y':0}
            # on_release: root.open_popup()
            on_release:
                root.change_toInventario()
                root.manager.transition.direction = 'right'

        Button:
            text: 'Mostrar Inventario'
            size_hint: 0.2, 0.05
            pos_hint: {'x': 0, 'y':0.05}
            on_release:
                # root.show_inventario_cluster()
                root.executefunc()
                # root.manager.transition.direction = "left"
            # on_release: threading.Thread(target=root.show_inventario_cluster, daemon=True).start()

        Button:
            text: 'Selecionar Shapefile'
            size_hint: 0.2, 0.05
            pos_hint: {'x':0.2, 'y':0}
            # on_release: root.open_popup_shp()
            on_release:
                root.change_toShape()
                root.manager.transition.direction = 'left'
        Button:
            text: 'Mostrar Shapefile'
            size_hint: 0.2, 0.05
            pos_hint: {'x':0.2, 'y':0.05}
            on_release: root.check_within_shp()
            # on_release: threading.Thread(target=root.check_within_shp).start()

        Button:
            text: 'Download'
            size_hint: 0.2, 0.05
            pos_hint: {'x':0.4, 'y':0}
            on_release: root.download_ANA_station()

# <LoadingScreen>:
#     name: 'loading'
#     BoxLayout:
#         Label:
#             text: 'LOADING...'
#         Button:
#             text: 'Voltar'
#             on_release:
#                 app.root.current = 'main'
#                 root.manager.transition.direction = "right"

<InventarioScreen>:
    name: 'inventario'
    GridLayout:
        rows: 4
        FileChooserListView:
            id: filechooserscreen
            filters: ['*.csv']
            on_submit:
                inventarioPath.text = filechooserscreen.selection[0]
        Button:
            text: 'Selecionar'
            on_release:
                # root.teste()
                root.show_inventarioCluster(filechooserscreen.selection)
        Button:
            text: 'Voltar'
            on_release:
                app.root.current='main'
                root.manager.transition.direction = "left"
        Label:
            id: inventarioPath
            text: 'Nada selecionado'

<ShapefileScreen>:
    name: 'shapefilescreen'
    GridLayout:
        rows: 4
        FileChooserListView:
            id: filechoosershape
            filters: ['*.shp']
            on_submit: shapePath.text = filechoosershape.selection[0]
        Button:
            text: 'Selecionar'
            on_release:
                root.get_codes(filechoosershape.selection)

        Button:
            text: 'Voltar'
            on_release:
                app.root.current = 'main'
                root.manager.transition.direction = 'right'
        Label:
            id: shapePath
            text: 'Nada selecionado'

# <CustomPopup>:
#     size_hint: 0.5, 0.5
#     title: "Selecione o arquivo 'Inventario.csv'"
#     FileChooserListView:
#         id: filechooser
#         size_hint: 1,1
#         filters: ['*.csv']
#         on_submit:
#             root.select_inventario(filechooser.selection)

<ShapefilePopup>:
    size_hint: 0.5, 0.5
    title: "Selecione o arquivo Shapefile '*.shp'"
    FileChooserListView:
        id: shapefile_chooser
        size_hint: 1,1
        filters: ['*.shp']
        on_submit:
            root.select_shapefile(shapefile_chooser.selection)
